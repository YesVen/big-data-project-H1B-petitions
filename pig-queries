grunt> countData = FOREACH groupByEmp GENERATE $2, COUNT(h1bdata) as APPLICATIONS;
2017-08-14 21:09:08,835 [main] ERROR org.apache.pig.tools.grunt.Grunt - ERROR 1000: <line 5, column 40> Out of bound access. 
Trying to access non-existent column: 2. Schema group:chararray,h1bdata:bag{:tuple(ID:int,CASE_STATUS:chararray,EMPLOYER_NAME:chararray,SOC_NAME:chararray,JOB_TITLE:chararray,FULL_TIME_POSITION:chararray,PREVAILING_WAGE:int,YEAR:int,WORKSITE:chararray,LONGITUDE:chararray,LATITUDE:chararray)} has 2 column(s).
Details at logfile: /home/oza/pig_1502758760828.log
grunt> countData = FOREACH groupByEmp GENERATE group, COUNT(h1bdata) as APPLICATIONS;
grunt> DUMP;

1) Number of engineers in the state? Map-Reduce Java

4) Which employers file the most petitions each year?  
    h1bdata = LOAD '/home/oza/Desktop/h1b_data_final_50.csv' using PigStorage(',') as (ID:int,CASE_STATUS:chararray,EMPLOYER_NAME:chararray,SOC_NAME:chararray,JOB_TITLE:chararray,FULL_TIME_POSITION:chararray,PREVAILING_WAGE:int,YEAR:int,WORKSITE:chararray,LONGITUDE:chararray,LATITUDE:chararray);
    groupByEmp = GROUP h1bdata BY (EMPLOYER_NAME,YEAR);
    countData = FOREACH groupByEmp GENERATE group.$0, group.$1, COUNT(h1bdata) as APPLICATIONS;
    orderBy = ORDER countData BY APPLICATIONS DESC;
    STORE groupByEmp INTO 'most_petitions_analysis'
    
1) Which state/place had most number of H1B petition with status DENIED?
    h1bdata = LOAD 'hdfs://localhost:9000/h1b-analysis/h1b_data_final.csv' using PigStorage(',') as (ID:int,CASE_STATUS:chararray,EMPLOYER_NAME:chararray,SOC_NAME:chararray,JOB_TITLE:chararray,FULL_TIME_POSITION:chararray,PREVAILING_WAGE:int,YEAR:int,WORKSITE:chararray,LONGITUDE:chararray,LATITUDE:chararray);
    filterdata = FILTER h1bdata by CASE_STATUS == 'DENIED';
    siteLatLongStatus = FOREACH filterdata GENERATE CASE_STATUS, WORKSITE, LATITUDE, LONGITUDE;
    groupBySite = GROUP siteLatLongStatus BY (WORKSITE);
    countData = FOREACH groupBySite GENERATE group, COUNT(siteLatLongStatus) as APPLICATIONS_DENIED;
    STORE countData INTO '/h1b-ouput/most_petitions_denied_places_analysis.csv' using PigStorage(',');
   
2) Which state/place had most number of H1B petition with status CERTFIED?
   h1bdata = LOAD '/home/oza/Desktop/h1b_data_final_50.csv' using PigStorage(',') as (ID:int,CASE_STATUS:chararray,EMPLOYER_NAME:chararray,SOC_NAME:chararray,JOB_TITLE:chararray,FULL_TIME_POSITION:chararray,PREVAILING_WAGE:int,YEAR:int,WORKSITE:chararray,LONGITUDE:chararray,LATITUDE:chararray);
   filterdata = FILTER h1bdata by CASE_STATUS == 'CERTIFIED';
   siteLatLongStatus = FOREACH filterdata GENERATE CASE_STATUS, WORKSITE, LATITUDE, LONGITUDE;
   groupBySite = GROUP siteLatLongStatus BY (WORKSITE);

3) Average salary for 'CERTIFIED' H1B cases in USA over the year.
   h1bdata = LOAD '/home/oza/Desktop/h1b_data_final_50.csv' using PigStorage(',') as (ID:int,CASE_STATUS:chararray,EMPLOYER_NAME:chararray,SOC_NAME:chararray,JOB_TITLE:chararray,FULL_TIME_POSITION:chararray,PREVAILING_WAGE:int,YEAR:int,WORKSITE:chararray,LONGITUDE:chararray,LATITUDE:chararray);
   filterdata = FILTER h1bdata by CASE_STATUS == 'CERTIFIED';
   groupByYear = GROUP filterdata BY (YEAR);
   avgData = FOREACH groupByYear GENERATE group as YEAR, ROUND(AVG($1.PREVAILING_WAGE)*100.00)/100.00 as AVERAGE_SALARY;

6) Top 15 States/Companies hiring the most.
   h1bdata = LOAD '/home/oza/Desktop/h1b_data_final_50.csv' using PigStorage(',') as (ID:int,CASE_STATUS:chararray,EMPLOYER_NAME:chararray,SOC_NAME:chararray,JOB_TITLE:chararray,FULL_TIME_POSITION:chararray,PREVAILING_WAGE:int,YEAR:int,WORKSITE:chararray,LONGITUDE:chararray,LATITUDE:chararray);
   filterdata = FILTER h1bdata by CASE_STATUS == 'CERTIFIED';
   groupByYear = GROUP filterdata BY SUBSTRING(WORKSITE,(int)INDEXOF(WORKSITE,'|',0)+2,(int)SIZE(WORKSITE));
   countData = FOREACH groupByYear GENERATE group, COUNT(filterdata) as HIRING_COUNT;
   orderByHiringCount = ORDER countData BY HIRING_COUNT DESC;
   top15 = LIMIT orderByHiringCount 15;
   
 7)Top 15 Job Titles;
   h1bdata = LOAD '/home/oza/Desktop/h1b_data_final_50.csv' using PigStorage(',') as (ID:int,CASE_STATUS:chararray,EMPLOYER_NAME:chararray,SOC_NAME:chararray,JOB_TITLE:chararray,FULL_TIME_POSITION:chararray,PREVAILING_WAGE:int,YEAR:int,WORKSITE:chararray,LONGITUDE:chararray,LATITUDE:chararray);
   filterdata = FILTER h1bdata BY YEAR == 2015;
   groupByYear = GROUP filterdata BY JOB_TITLE;
   countData = FOREACH groupByYear GENERATE group, COUNT(filterdata) as JOB_COUNT;
   orderByHiringCount = ORDER countData BY JOB_COUNT DESC;
   top15 = LIMIT orderByHiringCount 15;
